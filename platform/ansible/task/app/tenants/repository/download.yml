---
- block:
    - name: Detect git credential file
      local_action: 'stat path=/root/git/credential'
      register: git_credential
    - name: Download tenants repository
      include_role:
        name: app/tenants/repository/download
      vars:
        _repository: '{{ app.tenants.repository }}'
        _version: '{{ app.tenants.version }}'
        _credential: '{{ lookup("file", "/root/git/credential") if git_credential.stat.exists == true else "" }}'
  when: app.tenants.enabled
  tags: [tenants]
