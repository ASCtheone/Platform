---
- name: Backup identities fixtures directory
  shell: 'cp -R /srv/identities/src/AppBundle/Resources/data/{{ identities_data }} /srv/identities/src/AppBundle/Resources/data/_{{ identities_data }}'

- name: Download custom identities fixtures directory
  copy:
      src: '/root/resource/data/{{ identities_data }}/identities/'
      dest: '/srv/identities/src/AppBundle/Resources/data/{{ identities_data }}'

- import_tasks: load.yml

# The restore backup task below runs before docker-compose above finishes executing. Look into fixing this.
- name: Pause while identities fixtures load
  pause:
      seconds: 15

- name: Delete custom identities fixtures directory
  file:
      path: '/srv/identities/src/AppBundle/Resources/data/{{ identities_data }}'
      state: absent

- name: Restore identities fixtures directory backup
  shell: 'mv /srv/identities/src/AppBundle/Resources/data/_{{ identities_data }} /srv/identities/src/AppBundle/Resources/data/{{ identities_data }}'
